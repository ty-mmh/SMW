<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚»ã‚­ãƒ¥ã‚¢ãƒãƒ£ãƒƒãƒˆ - E2EEå¯¾å¿œç‰ˆ</title>
    <meta name="description" content="ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰æš—å·åŒ–å¯¾å¿œã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒ£ãƒƒãƒˆç©ºé–“">
    
    <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.socket.io https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' ws: wss:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ãƒ†ãƒ¼ãƒ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'><path stroke='%234f46e5' stroke-width='2' d='M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'/></svg>">
    <meta name="theme-color" content="#111827">
    
    <!-- React Development -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .glass-effect {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(55, 65, 81, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.7);
        }
        
        /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®ãƒªã‚µã‚¤ã‚ºç„¡åŠ¹åŒ– */
        textarea {
            resize: none;
        }
        
        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³èª¿æ•´ */
        input:focus, textarea:focus, button:focus {
            outline: none;
        }
        
        /* æš—å·åŒ–ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .encryption-indicator {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .encryption-enabled {
            color: #10b981;
        }
        
        .encryption-disabled {
            color: #f59e0b;
        }
        
        .encryption-error {
            color: #ef4444;
        }
        
        /* æš—å·åŒ–ãƒãƒƒã‚¸ */
        .crypto-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 9999px;
            border: 1px solid;
        }
        
        .crypto-badge.enabled {
            background-color: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .crypto-badge.disabled {
            background-color: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: #f59e0b;
        }
        
        .crypto-badge.error {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div id="loading" class="min-h-screen bg-gray-900 text-white flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 mx-auto mb-4 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            <h1 class="text-xl mb-2">ã‚»ã‚­ãƒ¥ã‚¢ãƒãƒ£ãƒƒãƒˆ</h1>
            <p class="text-gray-400 text-sm">æš—å·åŒ–ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...</p>
        </div>
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="root"></div>
    
    <!-- ã‚¨ãƒ©ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ -->
    <div id="error-fallback" style="display: none;" class="min-h-screen bg-gray-900 text-white flex items-center justify-center p-4">
        <div class="text-center max-w-md">
            <h1 class="text-2xl mb-4 text-red-400">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h1>
            <p class="text-gray-300 mb-6">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-medium transition duration-200">
                å†èª­ã¿è¾¼ã¿
            </button>
        </div>
    </div>
    
    <!-- è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // ç’°å¢ƒè¨­å®š
        window.API_BASE = 'http://localhost:3000/api';
        window.SOCKET_URL = 'http://localhost:3000';
        window.MESSAGE_EXPIRY_HOURS = '48';
        window.DEBUG_MODE = window.location.hostname === 'localhost' || window.location.search.includes('debug=true');
        
        // Tailwindè¨­å®š
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin-slow': 'spin 3s linear infinite',
                    },
                    colors: {
                        'crypto-green': '#10b981',
                        'crypto-yellow': '#f59e0b', 
                        'crypto-red': '#ef4444'
                    }
                }
            }
        };
        
        // åˆæœŸåŒ–ãƒ­ã‚°
        console.log('ğŸš€ ã‚»ã‚­ãƒ¥ã‚¢ãƒãƒ£ãƒƒãƒˆ E2EEå¯¾å¿œç‰ˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
        console.log('ğŸ“¡ API Base:', window.API_BASE);
        console.log('ğŸ”Œ WebSocket URL:', window.SOCKET_URL);
        console.log('ğŸ”’ æš—å·åŒ–ã‚µãƒãƒ¼ãƒˆ:', !!(window.crypto && window.crypto.subtle));
        console.log('ğŸ› ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰:', window.DEBUG_MODE);
        
        // Web Crypto API ã‚µãƒãƒ¼ãƒˆç¢ºèª
        if (!(window.crypto && window.crypto.subtle)) {
            console.warn('âš ï¸ Web Crypto API ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ - å¹³æ–‡é€šä¿¡ã«ãªã‚Šã¾ã™');
        } else {
            console.log('âœ… Web Crypto API ã‚µãƒãƒ¼ãƒˆç¢ºèªå®Œäº†');
        }
    </script>
    
    <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ï¼ˆä¾å­˜é–¢ä¿‚é †ï¼‰ -->
    <script src="/js/modules/icons.js"></script>
    <script src="/js/modules/utils.js"></script>
    <script src="/js/modules/sessionManager.js"></script>
    <script src="/js/modules/crypto.js"></script>  <!-- æ–°è¦è¿½åŠ  -->
    <script src="/js/modules/api.js"></script>
    <script src="/js/components/Login.js"></script>
    <script src="/js/components/Chat.js"></script>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <script src="/js/app.js"></script>
    
    <!-- åˆæœŸåŒ–ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° -->
    <script>
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã®åˆ¶å¾¡
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }
                
                // React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª
                if (!document.getElementById('root').hasChildNodes()) {
                    setTimeout(() => {
                        if (!document.getElementById('root').hasChildNodes()) {
                            console.error('âŒ React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—');
                            document.getElementById('error-fallback').style.display = 'flex';
                        }
                    }, 2000);
                }
            }, 500);
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (e) => {
            console.error('ğŸ› JavaScript ã‚¨ãƒ©ãƒ¼:', e.error);
            
            // æš—å·åŒ–é–¢é€£ã®ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ç‰¹åˆ¥ãªå‡¦ç†
            if (e.error?.message?.includes('crypto') || e.error?.message?.includes('encryption')) {
                console.warn('ğŸ”’ æš—å·åŒ–ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ - å¹³æ–‡ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™');
            }
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            console.error('ğŸ› Promise ã‚¨ãƒ©ãƒ¼:', e.reason);
        });
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
        if (window.DEBUG_MODE && window.performance) {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
                    console.log(`âš¡ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“: ${loadTime}ms`);
                }, 0);
            });
        }
        
        // ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ²ï¼ˆå°†æ¥ã®å®Ÿè£…ï¼‰
        if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
            navigator.serviceWorker.register('/sw.js').then((registration) => {
                console.log('âœ… Service Worker ç™»éŒ²æˆåŠŸ:', registration.scope);
            }).catch((error) => {
                console.log('âŒ Service Worker ç™»éŒ²å¤±æ•—:', error);
            });
        }
    </script>
</body>
</html>